INCLUDE "globals.def"

SECTION rodata_user

IF SCREEN_RES = RES_256x192

;===============================================================
;	HL in value
;	L returned clamped to 0-191
;===============================================================

PUBLIC _mod192

_mod192:

IF ALIGN_MOD_LUT
	ld a, l
	ld l, h
	ld h, mod192_lut >> 8
	sub (hl)
ELSE
	ld a, l
	ex af,af
	ld a, h
	ld hl, mod192_lut
	add hl, a
	ex af,af
	sub (hl)
ENDIF
	ld l, a
	ret nc
	add a, 192
	ld l, a
	ret

ELIF SCREEN_RES = RES_320x256

;===============================================================
;	HL in value
;	HL returned clamped to 0-319
;===============================================================

PUBLIC _mod320

_mod320:

	ld de, hl
IF ALIGN_MOD_LUT
	ld h, mod320_lut >> 8
	ld l, d
ELSE
	ld hl, mod320_lut
	ld a, d
	add hl, a
ENDIF
	ld d, (hl)
	dec d
	ld hl, de
	ret z
	dec d
	jr z, mod320_add64
	ld a, e
	sub d
	ld d, 0
	ld e, a
	ld hl, de
	ret nc
mod320_add64:
	add de, 64
	ld hl, de
	ret

ENDIF

IF ALIGN_MOD_LUT
SECTION lut_align_256
ENDIF

IF SCREEN_RES = RES_256x192

mod192_lut:
	; mod 3 based values for 0..127
	DB $C0,$80,$40,$C0,$80,$40,$C0,$80,$40,$C0,$80,$40,$C0,$80,$40,$C0,$80,$40,$C0,$80,$40,$C0,$80,$40,$C0,$80,$40,$C0,$80,$40,$C0,$80,$40
	DB $C0,$80,$40,$C0,$80,$40,$C0,$80,$40,$C0,$80,$40,$C0,$80,$40,$C0,$80,$40,$C0,$80,$40,$C0,$80,$40,$C0,$80,$40,$C0,$80,$40,$C0,$80,$40
	DB $C0,$80,$40,$C0,$80,$40,$C0,$80,$40,$C0,$80,$40,$C0,$80,$40,$C0,$80,$40,$C0,$80,$40,$C0,$80,$40,$C0,$80,$40,$C0,$80,$40,$C0,$80,$40
	DB $C0,$80,$40,$C0,$80,$40,$C0,$80,$40,$C0,$80,$40,$C0,$80,$40,$C0,$80,$40,$C0,$80,$40,$C0,$80,$40,$C0,$80,$40,$C0,$80
	; mod 3 based values for -$80..-1
	DB $80,$40
	DB $C0,$80,$40,$C0,$80,$40,$C0,$80,$40,$C0,$80,$40,$C0,$80,$40,$C0,$80,$40,$C0,$80,$40,$C0,$80,$40,$C0,$80,$40,$C0,$80,$40,$C0,$80,$40
	DB $C0,$80,$40,$C0,$80,$40,$C0,$80,$40,$C0,$80,$40,$C0,$80,$40,$C0,$80,$40,$C0,$80,$40,$C0,$80,$40,$C0,$80,$40,$C0,$80,$40,$C0,$80,$40
	DB $C0,$80,$40,$C0,$80,$40,$C0,$80,$40,$C0,$80,$40,$C0,$80,$40,$C0,$80,$40,$C0,$80,$40,$C0,$80,$40,$C0,$80,$40,$C0,$80,$40,$C0,$80,$40
	DB $C0,$80,$40,$C0,$80,$40,$C0,$80,$40,$C0,$80,$40,$C0,$80,$40,$C0,$80,$40,$C0,$80,$40,$C0,$80,$40,$C0,$80,$40

ELIF SCREEN_RES = RES_320x256

mod320_lut:
	; mod 5 based values for 0..127
	DB $01,$42,$82,$C2,$02,$01,$42,$82,$C2,$02,$01,$42,$82,$C2,$02,$01,$42,$82,$C2,$02,$01,$42,$82,$C2,$02,$01,$42,$82,$C2,$02,$01,$42,$82,$C2,$02
	DB $01,$42,$82,$C2,$02,$01,$42,$82,$C2,$02,$01,$42,$82,$C2,$02,$01,$42,$82,$C2,$02,$01,$42,$82,$C2,$02,$01,$42,$82,$C2,$02,$01,$42,$82,$C2,$02
	DB $01,$42,$82,$C2,$02,$01,$42,$82,$C2,$02,$01,$42,$82,$C2,$02,$01,$42,$82,$C2,$02,$01,$42,$82,$C2,$02,$01,$42,$82,$C2,$02,$01,$42,$82,$C2,$02
	DB $01,$42,$82,$C2,$02,$01,$42,$82,$C2,$02,$01,$42,$82,$C2,$02,$01,$42,$82,$C2,$02,$01,$42,$82
	; mod 5 based values for -$80..-1
	DB $82,$C2,$02
	DB $01,$42,$82,$C2,$02,$01,$42,$82,$C2,$02,$01,$42,$82,$C2,$02,$01,$42,$82,$C2,$02,$01,$42,$82,$C2,$02,$01,$42,$82,$C2,$02,$01,$42,$82,$C2,$02
	DB $01,$42,$82,$C2,$02,$01,$42,$82,$C2,$02,$01,$42,$82,$C2,$02,$01,$42,$82,$C2,$02,$01,$42,$82,$C2,$02,$01,$42,$82,$C2,$02,$01,$42,$82,$C2,$02
	DB $01,$42,$82,$C2,$02,$01,$42,$82,$C2,$02,$01,$42,$82,$C2,$02,$01,$42,$82,$C2,$02,$01,$42,$82,$C2,$02,$01,$42,$82,$C2,$02,$01,$42,$82,$C2,$02
	DB $01,$42,$82,$C2,$02,$01,$42,$82,$C2,$02,$01,$42,$82,$C2,$02,$01,$42,$82,$C2,$02

ENDIF